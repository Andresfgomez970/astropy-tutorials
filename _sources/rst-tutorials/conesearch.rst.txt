.. meta::
    :keywords: filterTutorials, filterAstroquery, filterTable, filterCoordinates, filterUnits, filterVo_Conesearch, filterLatex, filterSimbad, filterMatplotlib

.. raw:: html

    <a href="../_static/conesearch/conesearch.ipynb"><button id="download">Download tutorial notebook</button></a>
    <a href="https://beta.mybinder.org/v2/gh/astropy/astropy-tutorials/master?filepath=/tutorials/notebooks/conesearch/conesearch.ipynb"><button id="binder">Interactive tutorial notebook</button></a>

    <div id="spacer"></div>

.. meta::
    :keywords: filterTutorials, 

.. role:: inputnumrole
.. role:: outputnumrole

.. _conesearch:

Searching major star catalogs and Simbad by position or name with ``vo_conesearch``
===================================================================================

Authors
-------

P. L. Lim

Learning Goals
--------------

-  Perform a cone search around M31 using a web service.
-  Write the result out to a LaTeX table.
-  Perform a SIMBAD query using the cone search result.
-  Extract metadata from the cone search catalog.
-  Sort cone search results by angular distance.
-  Search multiple cone search services at once (synchronously and
   asynchronously).
-  Estimate the run time of a cone search.

Keywords
--------

astroquery, table, coordinates, units, vo_conesearch, LaTex, SIMBAD,
matplotlib

Summary
-------

This tutorial desmonstrates the `Cone
Search <http://astroquery.readthedocs.io/en/latest/vo_conesearch/vo_conesearch.html>`__
subpackage, which allows you to query a catalog of astronomical sources
and obtain those that lie within a cone of a given radius around the
given position.

Imports
~~~~~~~


:inputnumrole:`In[1]:`


.. code:: python

    # Python standard library
    import time
    import warnings
    
    # Third-party software
    import numpy as np
    
    # Astropy
    from astropy import coordinates as coord
    from astropy import units as u
    from astropy.table import Table
    
    # Astroquery. This tutorial requires 0.3.5 or greater.
    import astroquery
    from astroquery.simbad import Simbad
    from astroquery.vo_conesearch import conf, conesearch, vos_catalog
    
    # Set up matplotlib
    import matplotlib.pyplot as plt
    %matplotlib inline


:outputnumrole:`Out[1]:`


.. parsed-literal::

    WARNING: AstropyDeprecationWarning: astropy.extern.six will be removed in 4.0, use the six module directly if it is still needed [astropy.extern.six]


If you are running an older version of ``astroquery``, you might need to
set ``vos_baseurl`` yourself, as follows.


:inputnumrole:`In[2]:`


.. code:: python

    from astropy.utils import minversion
    
    if not minversion(astroquery, '0.3.10'):
        conf.vos_baseurl = 'https://astroconda.org/aux/vo_databases/'

To start, it might be useful to list the available Cone Search catalogs
first. By default, catalogs that pass nightly validation are included.
Validation is hosted by Space Telescope Science Institute (STScI).


:inputnumrole:`In[3]:`


.. code:: python

    conesearch.list_catalogs()


:outputnumrole:`Out[3]:`




.. parsed-literal::

    ['Guide Star Catalog 2.3 Cone Search 1',
     'SDSS DR7 - Sloan Digital Sky Survey Data Release 7 1',
     'SDSS DR7 - Sloan Digital Sky Survey Data Release 7 2',
     'SDSS DR7 - Sloan Digital Sky Survey Data Release 7 3',
     'SDSS DR7 - Sloan Digital Sky Survey Data Release 7 4',
     'SDSS DR8 - Sloan Digital Sky Survey Data Release 8 1',
     'SDSS DR8 - Sloan Digital Sky Survey Data Release 8 2',
     'The HST Guide Star Catalog, Version 1.1 (Lasker+ 1992) 1',
     'The HST Guide Star Catalog, Version 1.2 (Lasker+ 1996) 1',
     'The HST Guide Star Catalog, Version GSC-ACT (Lasker+ 1996-99) 1',
     'The USNO-A2.0 Catalogue (Monet+ 1998) 1',
     'Two Micron All Sky Survey (2MASS) 1',
     'Two Micron All Sky Survey (2MASS) 2']



Next, let’s pick an astronomical object of interest. For example, M31.


:inputnumrole:`In[4]:`


.. code:: python

    c = coord.SkyCoord.from_name('M31', frame='icrs')
    print(c)


:outputnumrole:`Out[4]:`


.. parsed-literal::

    <SkyCoord (ICRS): (ra, dec) in deg
        (10.68470833, 41.26875)>


By default, a basic Cone Search goes through the list of catalogs and
*stops* at the first one that returns non-empty VO table. Let’s search
for objects within 0.1 degree around M31. You will see a lot of warnings
that were generated by VO table parser but ignored by Cone Search
service validator. VO compliance enforced by Cone Search providers is
beyond the control of ``astroquery.vo_conesearch`` package.


:inputnumrole:`In[5]:`


.. code:: python

    result = conesearch.conesearch(c, 0.1 * u.degree)


:outputnumrole:`Out[5]:`


.. parsed-literal::

    Trying http://gsss.stsci.edu/webservices/vo/ConeSearch.aspx?CAT=GSC23&


.. parsed-literal::

    WARNING: W50: http://gsss.stsci.edu/webservices/vo/ConeSearch.aspx?CAT=GSC23&RA=10.68470833&DEC=41.26875&SR=0.1&VERB=1:154:0: W50: Invalid unit string 'pixel' [astropy.io.votable.tree]



:inputnumrole:`In[6]:`


.. code:: python

    print('First non-empty table returned by', result.url)
    print('Number of rows is', result.nrows)


:outputnumrole:`Out[6]:`


.. parsed-literal::

    First non-empty table returned by http://gsss.stsci.edu/webservices/vo/ConeSearch.aspx?CAT=GSC23&
    Number of rows is 4028


This VO table can be converted into `Astropy
table <http://astropy.readthedocs.io/en/stable/table/index.html>`__ and
then manipulated as such; e.g., re-write the table into LaTeX format.


:inputnumrole:`In[7]:`


.. code:: python

    result_tab = Table.read(result, format='votable')
    print(result_tab)


:outputnumrole:`Out[7]:`


.. parsed-literal::

        objID           gsc2ID      gsc1ID ... multipleFlag compassGSC2id   Mag  
                                           ...                              mag  
    -------------- ---------------- ------ ... ------------ ------------- -------
    23323175812944 00424433+4116085        ...            0 6453800072293   9.453
    23323175812948 00424403+4116069        ...            0 6453800072297   9.321
    23323175812933 00424455+4116103        ...            0 6453800072282  10.773
    23323175812939 00424464+4116092        ...            0 6453800072288   9.299
    23323175812930 00424403+4116108        ...            0 6453800072279  11.507
    23323175812931 00424464+4116106        ...            0 6453800072280   9.399
    23323175812973 00424446+4116016        ...            0 6453800072322   12.07
    23323175812966 00424398+4116028        ...            0 6453800072315  12.136
    23323175812979 00424420+4116009        ...            0 6453800072328  10.065
    23323175812958 00424377+4116045        ...            0 6453800072307  12.446
               ...              ...    ... ...          ...           ...     ...
     1330012229027    N330012229027        ...            0 6453800029027 20.3122
     1330012247547    N330012247547        ...            0 6453800047547 21.5449
     1330012244072    N330012244072        ...            0 6453800044072 20.9598
     1330012248107    N330012248107        ...            0 6453800048107 21.6947
      133001227000     N33001227000        ...            0 6453800007000 20.1382
     1330012244001    N330012244001        ...            0 6453800044001 21.8968
     1330012228861    N330012228861        ...            0 6453800028861 20.3572
     1330012212014    N330012212014        ...            0 6453800012014 16.5079
     1330012231849    N330012231849        ...            0 6453800031849 20.2869
     1330012210212    N330012210212        ...            0 6453800010212 20.2767
    Length = 4028 rows



:inputnumrole:`In[8]:`


.. code:: python

    result_tab.write('my_result.tex', format='ascii.latex')


:inputnumrole:`In[9]:`


.. code:: python

    # Now use your favorite text editor to open the my_result.tex file.
    # For example:
    !head my_result.tex


:outputnumrole:`Out[9]:`


.. parsed-literal::

    \begin{table}
    \begin{tabular}{cccccccccccccccccccccccccccccccccccccccccccccccccccccccc}
    objID & gsc2ID & gsc1ID & hstID & ra & dec & epoch & raEpsilon & decEpsilon & rapm & decpm & rapmErr & decpmErr & deltaEpoch & FpgMag & FpgMagErr & FpgMagCode & JpgMag & JpgMagErr & JpgMagCode & NpgMag & NpgMagErr & NpgMagCode & UMag & UMagErr & UMagCode & BMag & BMagErr & BMagCode & VMag & VMagErr & VMagCode & RMag & RMagErr & RMagCode & IMag & IMagErr & IMagCode & JMag & JMagErr & JMagCode & HMag & HMagErr & HMagCode & KMag & KMagErr & KMagCode & class & semiMajorAxis & eccentricity & positionAngle & sourceStatus & variableFlag & multipleFlag & compassGSC2id & Mag \\
     &  &  &  & $\mathrm{deg}$ & $\mathrm{deg}$ & $\mathrm{yr}$ & $\mathrm{arcsec}$ & $\mathrm{arcsec}$ & $\mathrm{mas\,yr^{-1}}$ & $\mathrm{mas\,yr^{-1}}$ & $\mathrm{mas\,yr^{-1}}$ & $\mathrm{mas\,yr^{-1}}$ & $\mathrm{yr}$ & $\mathrm{mag}$ & $\mathrm{mag}$ &  & $\mathrm{mag}$ & $\mathrm{mag}$ &  & $\mathrm{mag}$ & $\mathrm{mag}$ &  & $\mathrm{mag}$ & $\mathrm{mag}$ &  & $\mathrm{mag}$ & $\mathrm{mag}$ &  & $\mathrm{mag}$ & $\mathrm{mag}$ &  & $\mathrm{mag}$ & $\mathrm{mag}$ &  & $\mathrm{mag}$ & $\mathrm{mag}$ &  & $\mathrm{mag}$ & $\mathrm{mag}$ &  & $\mathrm{mag}$ & $\mathrm{mag}$ &  & $\mathrm{mag}$ & $\mathrm{mag}$ &  &  & pixel &  & $\mathrm{deg}$ &  &  &  &  & $\mathrm{mag}$ \\
    23323175812944 & 00424433+4116085 &  & 2MJG1R2O & 10.684737 & 41.269035 & 1997.815 & 0.08 & 0.07 & 0.0 & 0.0 & 0.0 & 0.0 & 0.0 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 9.453 & 0.052 & 47 & 8.668 & 0.051 & 48 & 8.475 & 0.051 & 49 & 4 & 0.0 & 0.0 & 0.0 & 77777700 & 0 & 0 & 6453800072293 & 9.453 \\
    23323175812948 & 00424403+4116069 &  & 2MJG1R2S & 10.683469 & 41.268585 & 1997.815 & 0.13 & 0.12 & 0.0 & 0.0 & 0.0 & 0.0 & 0.0 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 9.321 & -999.0 & 47 & 8.614 & -999.0 & 48 & 10.601 & 0.025 & 49 & 4 & 0.0 & 0.0 & 0.0 & 77777700 & 0 & 0 & 6453800072297 & 9.321 \\
    23323175812933 & 00424455+4116103 &  & 2MJG1R2D & 10.685657 & 41.26955 & 1997.815 & 0.13 & 0.12 & 0.0 & 0.0 & 0.0 & 0.0 & 0.0 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 10.773 & 0.069 & 47 & 8.532 & -999.0 & 48 & 8.254 & -999.0 & 49 & 4 & 0.0 & 0.0 & 0.0 & 77777700 & 0 & 0 & 6453800072282 & 10.773 \\
    23323175812939 & 00424464+4116092 &  & 2MJG1R2J & 10.686026 & 41.269226 & 1997.815 & 0.13 & 0.12 & 0.0 & 0.0 & 0.0 & 0.0 & 0.0 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 9.299 & -999.0 & 47 & 8.606 & -999.0 & 48 & 10.119 & 0.056 & 49 & 4 & 0.0 & 0.0 & 0.0 & 77777700 & 0 & 0 & 6453800072288 & 9.299 \\
    23323175812930 & 00424403+4116108 &  & 2MJG1R2A & 10.683465 & 41.269676 & 1997.815 & 0.13 & 0.11 & 0.0 & 0.0 & 0.0 & 0.0 & 0.0 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 11.507 & 0.056 & 47 & 8.744 & -999.0 & 48 & 8.489 & -999.0 & 49 & 4 & 0.0 & 0.0 & 0.0 & 77777700 & 0 & 0 & 6453800072279 & 11.507 \\
    23323175812931 & 00424464+4116106 &  & 2MJG1R2B & 10.686015 & 41.26963 & 1997.815 & 0.13 & 0.12 & 0.0 & 0.0 & 0.0 & 0.0 & 0.0 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 99.99 & 99.99 & 99 & 9.399 & -999.0 & 47 & 9.985 & 0.07 & 48 & 8.429 & -999.0 & 49 & 4 & 0.0 & 0.0 & 0.0 & 77777700 & 0 & 0 & 6453800072280 & 9.399 \\


Cone Search results can also be used in conjuction with other types of
queries. For example, you can query SIMBAD for the first entry in your
result above.


:inputnumrole:`In[10]:`


.. code:: python

    # Due to the unpredictability of external services,
    # The first successful query result (above) might differ
    # from run to run.
    #
    # CHANGE THESE VALUES to the appropriate RA and DEC
    # column names you see above, if necessary.
    # These are for http://gsss.stsci.edu/webservices/vo/ConeSearch.aspx?CAT=GSC23&
    ra_colname = 'ra'
    dec_colname = 'dec'


:inputnumrole:`In[11]:`


.. code:: python

    # Don't run this cell if column names above are invalid.
    if ra_colname in result_tab.colnames and dec_colname in result_tab.colnames:
        row = result_tab[0]
        simbad_obj = coord.SkyCoord(ra=row[ra_colname]*u.deg, dec=row[dec_colname]*u.deg)
        print('Searching SIMBAD for\n{}\n'.format(simbad_obj))
        simbad_result = Simbad.query_region(simbad_obj, radius=5*u.arcsec)
        print(simbad_result)
    else:
        print('{} or {} not in search results. Choose from: {}'.format(
            ra_colname, dec_colname, ' '.join(result_tab.colnames)))


:outputnumrole:`Out[11]:`


.. parsed-literal::

    Searching SIMBAD for
    <SkyCoord (ICRS): (ra, dec) in deg
        (10.684737, 41.269035)>
    
                MAIN_ID                  RA      ...     COO_BIBCODE    
                                      "h:m:s"    ...                    
    ------------------------------- ------------ ... -------------------
                   NAME P2B Cluster  00 42 44.34 ... 2010ApJ...710..755G
                         [LFG93] P3  00 42 44.34 ... 2010ApJ...710..755G
                          NAME M31*  00 42 44.33 ... 1993ApJ...411L.107C
        [K2002] J004244.35+411608.9 00 42 44.351 ... 2002ApJ...577..738K
                          HD   3969 00 42 44.367 ... 1988A&AS...74..449R
                      [HPH2013] 165  00 42 44.34 ... 2013A&A...555A..65H
                      [HPH2013] 164  00 42 44.30 ... 2013A&A...555A..65H
                         [LFG93] P1  00 42 44.37 ... 2010ApJ...710..755G
        [KPM2002] G121.1741-21.5730  00 42 44.27 ... 2002AJ....124.2990K
                      [O2006] QSS 8 00 42 44.365 ... 2002ApJ...577..738K
                                ...          ... ...                 ...
            CXOGMP J004244.2+411608   00 42 44.2 ... 2001A&A...365L.195S
                      [HPH2013] 170  00 42 44.40 ... 2013A&A...555A..65H
            XMMM31 J004244.1+411607  00 42 44.19 ... 2005A&A...434..483P
                      [HPH2013] 172  00 42 44.47 ... 2013A&A...555A..65H
                      [HPH2013] 169  00 42 44.39 ... 2013A&A...555A..65H
                      M31N 2004-09b  00 42 44.45 ... 2007A&A...465..375P
                      [HPH2013] 166 00 42 44.355 ... 2002ApJ...577..738K
                        [PSC2013] 9 00 42 44.060 ... 2013MNRAS.430.1219P
                       [LGF2011] S1  00 42 44.36 ... 2011ApJ...728L..10L
    NAME Nova Treffers 1993 in M 31     00 42 44 ...                    
    Length = 25 rows


Now back to Cone Search… You can extract metadata of this Cone Search
catalog.


:inputnumrole:`In[12]:`


.. code:: python

    my_db = vos_catalog.get_remote_catalog_db(conf.conesearch_dbname)
    my_cat = my_db.get_catalog_by_url(result.url)
    print(my_cat.dumps())


:outputnumrole:`Out[12]:`


.. parsed-literal::

    {
        "authenticated_only": 0,
        "cap_description": "",
        "cap_index": 1,
        "cap_type": "conesearch",
        "content_level": "research",
        "content_type": "catalog",
        "created": "12/4/2008 3:29:11 PM",
        "creator_seq": "",
        "duplicatesIgnored": 0,
        "intf_index": 1,
        "intf_role": "std",
        "intf_type": "vs:paramhttp",
        "ivoid": "ivo://archive.stsci.edu/gsc/gsc2.3",
        "mirror_url": "",
        "query_type": "",
        "reference_url": "http://gsss.stsci.edu/Catalogs/GSC/GSC2/GSC2.htm",
        "region_of_regard": NaN,
        "res_description": "The Guide Star Catalog II (GSC-II) is an all-sky optical catalog based on 1\" resolution scans of the photographic Sky Survey plates, at two epochs and three bandpasses, from the Palomar and UK Schmidt telescopes. This all-sky catalog will ultimately contains positions, proper motions, classifications, and magnitudes in multiple bandpasses for almost a billion objects down to approximately Jpg=21, Fpg=20. The GSC-II is currently used for HST Bright Object Protection and HST pointing. Looking ahead, the GSC-II will form the basis of the Guide Star Catalog for JWST. This was constructed in collaboration with ground-based observatories for use with the GEMINI, VLT and GALILEO telescopes",
        "res_subject": "Surveys",
        "res_type": "vs:catalogservice",
        "res_version": "2.3.2",
        "result_type": "",
        "rights": "",
        "rights_uri": "",
        "short_name": "GSC23",
        "source_format": "",
        "source_value": "",
        "standard_id": "ivo://ivoa.net/std/conesearch",
        "std_version": "",
        "title": "Guide Star Catalog 2.3 Cone Search",
        "updated": "7/25/2018 4:14:19 PM",
        "url": "http://gsss.stsci.edu/webservices/vo/ConeSearch.aspx?CAT=GSC23&",
        "url_use": "base",
        "validate_expected": "good",
        "validate_network_error": null,
        "validate_nexceptions": 0,
        "validate_nwarnings": 2,
        "validate_out_db_name": "good",
        "validate_version": "1.2",
        "validate_warning_types": [
            "W50"
        ],
        "validate_warnings": [
            "/var/www/astroconda.org/html/aux/vo_databases/daily_20190905/results/91/13/e0bb2f53e1be973136ff8afe5ae9/vo.xml:154:0: W50: Invalid unit string 'pixel'",
            "/var/www/astroconda.org/html/aux/vo_databases/daily_20190905/results/91/13/e0bb2f53e1be973136ff8afe5ae9/vo.xml:154:0: W50: Invalid unit string 'pixel'"
        ],
        "validate_xmllint": true,
        "validate_xmllint_content": "/var/www/astroconda.org/html/aux/vo_databases/daily_20190905/results/91/13/e0bb2f53e1be973136ff8afe5ae9/vo.xml validates\n",
        "waveband": "optical",
        "wsdl_url": ""
    }


If you have a favorite catalog in mind, you can also perform Cone Search
only on that catalog. A list of available catalogs can be obtained by
calling ``conesearch.list_catalogs()``, as mentioned above.


:inputnumrole:`In[13]:`


.. code:: python

    result = conesearch.conesearch(
        c, 0.1 * u.degree, catalog_db='The USNO-A2.0 Catalogue (Monet+ 1998) 1')


:outputnumrole:`Out[13]:`


.. parsed-literal::

    Trying http://vizier.u-strasbg.fr/viz-bin/conesearch/I/252/out?



:inputnumrole:`In[14]:`


.. code:: python

    print('Number of rows is', result.nrows)


:outputnumrole:`Out[14]:`


.. parsed-literal::

    Number of rows is 3


Let’s explore the 3 rows of astronomical objects found within 0.1 degree
of M31 in the given catalog and sort them by increasing distance. For
this example, the VO table has several columns that might include:

-  ``_r`` = Angular distance (in degrees) between object and M31
-  ``USNO-A2.0`` = Catalog ID of the object
-  ``RAJ2000`` = Right ascension of the object (epoch=J2000)
-  ``DEJ2000`` = Declination of the object (epoch=J2000)

Note that column names, meanings, order, etc. might vary from catalog to
catalog.


:inputnumrole:`In[15]:`


.. code:: python

    data_array = result.array.data
    print(data_array)


:outputnumrole:`Out[15]:`


.. parsed-literal::

    [(0.094265, b'1275-00425574', 10.595878, 41.335328, b'', b'', 19.8, 17.4, 1953.773)
     (0.09804 , b'1275-00427192', 10.639945, 41.360845, b'', b'', 19.4, 18.4, 1953.773)
     (0.06328 , b'1275-00429939', 10.712834, 41.209109, b'A', b'', 99.9, 11.2,      nan)]



:inputnumrole:`In[16]:`


.. code:: python

    col_names = data_array.dtype.names
    print(col_names)


:outputnumrole:`Out[16]:`


.. parsed-literal::

    ('_r', 'USNO-A2.0', 'RAJ2000', 'DEJ2000', 'ACTflag', 'Mflag', 'Bmag', 'Rmag', 'Epoch')



:inputnumrole:`In[17]:`


.. code:: python

    distance = data_array['_r']
    sorted_indices = np.argsort(distance)
    sorted_data_array = data_array[sorted_indices]
    print(sorted_data_array)


:outputnumrole:`Out[17]:`


.. parsed-literal::

    [(0.06328 , b'1275-00429939', 10.712834, 41.209109, b'A', b'', 99.9, 11.2,      nan)
     (0.094265, b'1275-00425574', 10.595878, 41.335328, b'', b'', 19.8, 17.4, 1953.773)
     (0.09804 , b'1275-00427192', 10.639945, 41.360845, b'', b'', 19.4, 18.4, 1953.773)]


You can also convert the distance to arcseconds.


:inputnumrole:`In[18]:`


.. code:: python

    distance_field = result.get_field_by_id('_r')
    print('Field title:', distance_field.title)
    print('Unit is', distance_field.unit)


:outputnumrole:`Out[18]:`


.. parsed-literal::

    Field title: Distance from center (010.684708+41.268750)[FK5/J2000], at Epoch of catalog (Epoch)
    Unit is deg



:inputnumrole:`In[19]:`


.. code:: python

    sorted_distance = distance[sorted_indices]
    distance_arcsec = (sorted_distance * distance_field.unit).to(u.arcsec)
    for d_deg, d_arcsec in zip(sorted_distance, distance_arcsec):
        print('{:.6f} deg converted to {:.4f}'.format(d_deg, d_arcsec))


:outputnumrole:`Out[19]:`


.. parsed-literal::

    0.063280 deg converted to 227.8080 arcsec
    0.094265 deg converted to 339.3540 arcsec
    0.098040 deg converted to 352.9440 arcsec


What if you want *all* the results from *all* the catalogs? And you also
want to suppress all the VO table warnings and informational messages?

**Warning: This can be time and resource intensive.**


:inputnumrole:`In[20]:`


.. code:: python

    with warnings.catch_warnings():
        warnings.simplefilter('ignore')
        all_results = conesearch.search_all(c, 0.1 * u.degree, verbose=False)


:inputnumrole:`In[21]:`


.. code:: python

    for url, tab in all_results.items():
        print(url, 'returned', tab.nrows, 'rows')


:outputnumrole:`Out[21]:`


.. parsed-literal::

    http://gsss.stsci.edu/webservices/vo/ConeSearch.aspx?CAT=GSC23& returned 4028 rows
    http://vizier.u-strasbg.fr/viz-bin/conesearch/I/220/out? returned 5 rows
    http://vizier.u-strasbg.fr/viz-bin/conesearch/I/254/out? returned 5 rows
    http://vizier.u-strasbg.fr/viz-bin/conesearch/I/255/out? returned 5 rows
    http://vizier.u-strasbg.fr/viz-bin/conesearch/I/252/out? returned 3 rows
    http://wfaudata.roe.ac.uk/twomass-dsa/DirectCone?DSACAT=TWOMASS&DSATAB=twomass_xsc& returned 25 rows
    http://wfaudata.roe.ac.uk/twomass-dsa/DirectCone?DSACAT=TWOMASS&DSATAB=twomass_psc& returned 2008 rows



:inputnumrole:`In[22]:`


.. code:: python

    i220keys = [k for k in all_results if 'I/220' in k]  # pick out the first one with "I/220" in it
    my_favorite_result = all_results[i220keys[0]]
    print(my_favorite_result.array.data.dtype.names)
    print(my_favorite_result.array.data)


:outputnumrole:`Out[22]:`


.. parsed-literal::

    ('_r', 'GSC', 'RAJ2000', 'DEJ2000', 'PosErr', 'Pmag', 'e_Pmag', 'n_Pmag', 'Class', 'Plate', 'Epoch', 'Mult', 'Versions')
    [(0.063449, b'0280102008', 10.71207, 41.20873, 0.2, 11.82, 0.43, 1, 0, b'0738', 1985.877, b'F', b'GSC-all')
     (0.043453, b'0280102015', 10.68782, 41.22536, 0.2, 13.1 , 0.44, 1, 3, b'0738', 1985.877, b'F', b'GSC-all')
     (0.09617 , b'0280102081', 10.80558, 41.23727, 0.2, 13.44, 0.46, 1, 0, b'0738', 1985.877, b'F', b'GSC-all')
     (0.066633, b'0280102017', 10.60025, 41.24853, 0.2, 13.47, 0.46, 1, 3, b'0738', 1985.877, b'F', b'GSC-all')
     (0.082097, b'0280502180', 10.64539, 41.34535, 0.2, 12.68, 0.44, 1, 0, b'0738', 1985.877, b'F', b'GSC-all')]


Asynchronous Searches
~~~~~~~~~~~~~~~~~~~~~

Asynchronous versions (i.e., search will run in the background) of
``conesearch()`` and ``search_all()`` are also available. Result can be
obtained using the asynchronous instance’s ``get()`` method that returns
the result upon completion or after a given ``timeout`` value in
seconds.


:inputnumrole:`In[23]:`


.. code:: python

    async_search = conesearch.AsyncConeSearch(
        c, 0.1 * u.degree, catalog_db='The USNO-A2.0 Catalogue (Monet+ 1998) 1')
    print('Am I running?', async_search.running())
    
    time.sleep(3)
    print('After 3 seconds. Am I done?', async_search.done())
    print()
    
    result = async_search.get(timeout=30)
    print('Number of rows returned is', result.nrows)


:outputnumrole:`Out[23]:`


.. parsed-literal::

    Am I running? True
    After 3 seconds. Am I done? True
    
    Number of rows returned is 3



:inputnumrole:`In[24]:`


.. code:: python

    async_search_all = conesearch.AsyncSearchAll(c, 0.1 * u.degree)
    print('Am I running?', async_search_all.running())
    print('Am I done?', async_search_all.done())
    print()
    
    all_results = async_search_all.get(timeout=30)
    for url, tab in all_results.items():
        print(url, 'returned', tab.nrows, 'rows')


:outputnumrole:`Out[24]:`


.. parsed-literal::

    Am I running? True
    Am I done? False
    
    http://gsss.stsci.edu/webservices/vo/ConeSearch.aspx?CAT=GSC23& returned 4028 rows
    http://vizier.u-strasbg.fr/viz-bin/conesearch/I/220/out? returned 5 rows
    http://vizier.u-strasbg.fr/viz-bin/conesearch/I/254/out? returned 5 rows
    http://vizier.u-strasbg.fr/viz-bin/conesearch/I/255/out? returned 5 rows
    http://vizier.u-strasbg.fr/viz-bin/conesearch/I/252/out? returned 3 rows
    http://wfaudata.roe.ac.uk/twomass-dsa/DirectCone?DSACAT=TWOMASS&DSATAB=twomass_xsc& returned 25 rows
    http://wfaudata.roe.ac.uk/twomass-dsa/DirectCone?DSACAT=TWOMASS&DSATAB=twomass_psc& returned 2008 rows


Estimating the Search Time
~~~~~~~~~~~~~~~~~~~~~~~~~~

Let’s predict the run time of performing Cone Search on
``http://gsss.stsci.edu/webservices/vo/ConeSearch.aspx?CAT=GSC23&`` with
a radius of 0.1 degrees. For now, the prediction assumes a very simple
linear model, which might or might not reflect the actual trend.

This might take a while.


:inputnumrole:`In[25]:`


.. code:: python

    with warnings.catch_warnings():
        warnings.simplefilter('ignore')
        t_est, n_est = conesearch.predict_search(
            'http://gsss.stsci.edu/webservices/vo/ConeSearch.aspx?CAT=GSC23&',
            c, 0.1 * u.degree, verbose=False, plot=True)


:outputnumrole:`Out[25]:`



.. image:: nboutput/conesearch_41_0.png




.. image:: nboutput/conesearch_41_1.png




:inputnumrole:`In[26]:`


.. code:: python

    print('Predicted run time is', t_est, 'seconds')
    print('Predicted number of rows is', n_est)


:outputnumrole:`Out[26]:`


.. parsed-literal::

    Predicted run time is 0.4696482712664896 seconds
    Predicted number of rows is 2617


Let’s get the actual run time and number of rows to compare with the
prediction above. This might take a while.

As you will see, the prediction is not spot on, but it’s not too shabby
(at least, not when we tried it!) Note that both predicted and actual
run time results also depend on network latency and responsiveness of
the service provider.


:inputnumrole:`In[27]:`


.. code:: python

    t_real, tab = conesearch.conesearch_timer(
        c, 0.1 * u.degree,
        catalog_db='http://gsss.stsci.edu/webservices/vo/ConeSearch.aspx?CAT=GSC23&',
        verbose=False)


:outputnumrole:`Out[27]:`


.. parsed-literal::

    INFO: conesearch_timer took 0.7832655906677246 s on AVERAGE for 1 call(s). [astropy.utils.timer]



:inputnumrole:`In[28]:`


.. code:: python

    print('Actual run time is', t_real, 'seconds')
    print('Actual number of rows is', tab.nrows)


:outputnumrole:`Out[28]:`


.. parsed-literal::

    Actual run time is 0.7832655906677246 seconds
    Actual number of rows is 4028






.. raw:: html

    <div id="spacer"></div>

    <a href="../_static/conesearch/conesearch.ipynb"><button id="download">Download tutorial notebook</button></a>
    <a href="https://beta.mybinder.org/v2/gh/astropy/astropy-tutorials/master?filepath=/tutorials/notebooks/conesearch/conesearch.ipynb"><button id="binder">Interactive tutorial notebook</button></a>

